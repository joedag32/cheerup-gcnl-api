<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Azure Text Analytics REST API</title>
  </head>
  <body>
    <h1>Azure Text Analytics REST API</h1>
    <label for="testValue">Test Value:</label>
    <textarea id="testValue" name="testValue" rows="4" cols="50">
      Biden campaign manager Jen O’Malley Dillon is urging patience as the results continue to filter in, saying that while the story is going to be "very positive" for Biden, the counting is still happening and it’s going to take time. 
      I think the story of today is going to be a very positive story for the vice president but also one where folks are going to need to stay patient and stay calm,” said Dillon. "The counting is happening, it's going to take time. We need to allow it to get done and done well, and we are very confident whatever happens with the counting and the timing we will come out ahead. We are absolutely confident that Joe Biden will be the next president of the United States.
    </textarea>
    <button type="button" id="analyzeButton">Analyze Text!</button>
    <h2>Returned Key Phrases</h2>
    <div id="returnedObject"></div>
    <script>
      /* declare some variables */
      const functionURL =
        "https://eastus.api.cognitive.microsoft.com/text/analytics/v3.0/keyPhrases";
      const input = document.getElementById("testValue");
      const analyzeButton = document.getElementById("analyzeButton");
      const objectOutput = document.getElementById("returnedObject");
      const testValue = input.value;
      /* set value of input field as the body to be sent via the POST request */
      const postData = {
        documents: [
          {
            language: "en",
            id: "1",
            text: testValue
          }
        ]
      };

      /* update value of input to pass */
      input.addEventListener("input", updateValue);
      function updateValue(e) {
        postData.documents[0].text = e.target.value;
      }

      analyzeButton.addEventListener("click", analyzeText);
      /* call Azure Function via HTTP POST and return a very simple object  */
      function analyzeText(e) {
        console.log(postData);
        fetch(functionURL, {
          method: "POST",
          headers: {
            "Ocp-Apim-Subscription-Key": "659f9c405d9f4c4ca9671ea7eec23117",
            "Content-Type": "application/json",
            Accept: "application/json"
          },
          body: JSON.stringify(postData)
        })
          .then(res => res.json())
          .then(data => {
            console.log(data);
            objectOutput.innerHTML = data.documents[0].keyPhrases;
          })
          .catch(error => {
            console.error(error);
          });
      }
    </script>
  </body>
</html>
